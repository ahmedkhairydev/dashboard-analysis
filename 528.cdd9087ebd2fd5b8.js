"use strict";(self.webpackChunkdashboard_analysis=self.webpackChunkdashboard_analysis||[]).push([[528],{4528:(q,x,i)=>{i.r(x),i.d(x,{HomeModule:()=>z});var m=i(9808),g=i(4495),t=i(5e3),y=i(1135),f=i(4004),C=i(520);let F=(()=>{class o{constructor(e){this.http=e}get(e){return this.http.get(`${e.APIName}`,{params:e.params}).pipe((0,f.U)(s=>s))}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(C.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),b=(()=>{class o{constructor(e){this.http=e,this.chartData=new y.X(null),this.selectedPoint=new y.X(null),this.selectedPoint$=this.selectedPoint.asObservable()}get chartData$(){return this.chartData.value?this.chartData.asObservable():this.http.get({APIName:"https://raw.githubusercontent.com/mosafwat/analysis-fe-challenge/master/data.json"}).pipe((0,f.U)(e=>(this.chartData.next(e),e)))}get countries(){return this.chartData$.pipe((0,f.U)(e=>[...new Set(null==e?void 0:e.map(a=>a.country))].map((a,n)=>({id:n+1,text:a}))))}get camps(){return this.chartData$.pipe((0,f.U)(e=>[...new Set(null==e?void 0:e.map(a=>a.camp))].map((a,n)=>({id:n+1,text:a}))))}get schools(){return this.chartData$.pipe((0,f.U)(e=>[...new Set(null==e?void 0:e.map(a=>a.school))].map((a,n)=>({id:n+1,text:a}))))}get months(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}get monthsArabic(){return["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0629","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"]}addPoint(e){this.selectedPoint.next(e)}generateSeriesDataByMonths(e){const a=e.reduce((n,c)=>(n[c.month]=n[c.month]?[n[c.month],c.lessons].reduce((p,u)=>p+u):c.lessons,n),{});return this.months.map(n=>a[n]?a[n]:0)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(F))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var S=i(7232);function Z(o,r){if(1&o&&(t.TgZ(0,"label",9),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"uppercase"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,t.lcZ(3,3,"FIELDS."+e)))}}const L=function(o){return{"d-none":o}};function A(o,r){if(1&o&&(t.TgZ(0,"div",6),t.YNc(1,Z,4,5,"label",7),t.TgZ(2,"h6",8),t._uU(3),t.qZA()()),2&o){const e=r.$implicit,s=t.oxw(2);t.Q6J("ngClass",t.VKq(3,L,!s.chartDetails[e])),t.xp6(1),t.Q6J("ngIf",s.chartDetails[e]),t.xp6(2),t.Oqu(s.chartDetails[e])}}function D(o,r){if(1&o&&(t.TgZ(0,"div",1)(1,"h3",2),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",3)(5,"div",4),t.YNc(6,A,4,5,"div",5),t.qZA()()()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"CHART_DETAILS")),t.xp6(4),t.Q6J("ngForOf",e.chartDetailsKeys)}}let T=(()=>{class o{constructor(e){this.homeService=e}ngOnInit(){this.homeService.selectedPoint$.subscribe(e=>{this.chartDetails=e||JSON.parse(localStorage.getItem("selectedPoint")),this.chartDetailsKeys=Object.keys(this.chartDetails)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-details"]],decls:1,vars:1,consts:[["class","details page-wrapper d-flex flex-column h-100",4,"ngIf"],[1,"details","page-wrapper","d-flex","flex-column","h-100"],[1,"m-0","regular","font-26","text-main"],[1,"d-flex","justify-content-center","align-items-center","h-100"],[1,"chart","p-4","bg-white","box-shadow"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["for","value","class","text-middle font-14 mb-1",4,"ngIf"],[1,"m-0","font-16","fw-bold"],["for","value",1,"text-middle","font-14","mb-1"]],template:function(e,s){1&e&&t.YNc(0,D,7,4,"div",0),2&e&&t.Q6J("ngIf",s.chartDetailsKeys)},directives:[m.O5,m.sg,m.mk],pipes:[S.X$,m.gd],styles:["app-details{flex-grow:1}  app-details .chart{width:100%;display:grid;grid-template-columns:repeat(1,1fr);grid-auto-rows:auto;grid-gap:1.5rem}@media only screen and (min-width: 640px){  app-details .chart{width:auto;grid-template-columns:repeat(2,minmax(250px,1fr))}}"]}),o})();var I=i(7579),P=i(9300),O=i(2722),d=i(3075),w=i(4106),J=i(7813),N=i(508);function G(o,r){if(1&o&&(t.TgZ(0,"mat-option",3),t._uU(1),t.qZA()),2&o){const e=r.$implicit,s=t.oxw();t.Q6J("value",e[s.bindValue]),t.xp6(1),t.hij(" ",e.text," ")}}let H=(()=>{class o{constructor(){this.appearance="fill",this.bindValue="id"}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dropdown"]],inputs:{formGroup:"formGroup",controlName:"controlName",options:"options",label:"label",appearance:"appearance",bindValue:"bindValue"},decls:6,vars:7,consts:[[1,"w-100",3,"formGroup","appearance"],[3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,s){1&e&&(t.TgZ(0,"mat-form-field",0)(1,"mat-label"),t._uU(2),t.qZA(),t.TgZ(3,"mat-select",1),t.YNc(4,G,2,2,"mat-option",2),t.ALo(5,"async"),t.qZA()()),2&e&&(t.Q6J("formGroup",s.formGroup)("appearance",s.appearance),t.xp6(2),t.Oqu(s.label),t.xp6(1),t.Q6J("formControlName",s.controlName),t.xp6(1),t.Q6J("ngForOf",t.lcZ(5,5,s.options)))},directives:[w.KE,d.JL,d.sg,w.hX,J.gD,d.JJ,d.u,m.sg,N.ey],pipes:[m.Ov],styles:[""]}),o})();var $=i(226),E=i(2115);let U=(()=>{class o{constructor(){this.selectedPoint=new t.vpe}ngOnInit(){this.chartOptions={labels:this.labels,series:this.series,colors:this.colors,chart:{type:"line",fontFamily:"Cairo",foreColor:"#1d252d",height:350,toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(e,s,a)=>{const c=a.dataPointIndex,p=this.series[a.seriesIndex];this.selectedPoint.emit({month:this.labels[c],school:p.name,totalMonthLesson:p.data[c]})}}},legend:{show:!0,width:250,position:"right",fontFamily:"Cairo",markers:{width:7,height:17,radius:2,offsetX:0,offsetY:0},labels:{useSeriesColors:!0},itemMargin:{horizontal:0,vertical:8},formatter:(e,s)=>{const a=s.w.config.series[s.seriesIndex].data;return a.length?`${e} - ${a.reduce((c,p)=>c+p)} Lessons`:e}},stroke:{curve:"smooth"},grid:{row:{colors:["#8b61a880","transparent"],opacity:.5}},yaxis:{title:{text:this.yaxisTitle,style:{fontSize:"1rem"}}},tooltip:{enabled:!0,intersect:!0,shared:!1},markers:{size:5},responsive:[{breakpoint:640,options:{chart:{zoom:{enabled:!0}},legend:{position:"bottom"}}}]}}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-line"]],inputs:{labels:"labels",series:"series",colors:"colors",yaxisTitle:"yaxisTitle"},outputs:{selectedPoint:"selectedPoint"},decls:2,vars:11,consts:[["dir","ltr"],[3,"labels","series","colors","chart","legend","stroke","grid","yaxis","markers","tooltip","responsive"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"apx-chart",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("labels",s.chartOptions.labels)("series",s.chartOptions.series)("colors",s.chartOptions.colors)("chart",s.chartOptions.chart)("legend",s.chartOptions.legend)("stroke",s.chartOptions.stroke)("grid",s.chartOptions.grid)("yaxis",s.chartOptions.yaxis)("markers",s.chartOptions.markers)("tooltip",s.chartOptions.tooltip)("responsive",s.chartOptions.responsive))},directives:[$.Lv,E.x],styles:[".apexcharts-canvas .apexcharts-datalabel{fill:#1d252d}  .apexcharts-canvas .apexcharts-legend{flex-direction:column}  .apexcharts-canvas .apexcharts-legend .apexcharts-legend-series{display:flex;align-items:center;height:max-content}  .apexcharts-canvas .apexcharts-legend .apexcharts-legend-series .apexcharts-legend-marker{width:7px!important;height:17px!important;margin-right:0;margin-inline-end:16px}  .apexcharts-canvas .apexcharts-legend .apexcharts-legend-series .apexcharts-legend-text{color:#1d252d!important}"]}),o})();function M(o,r){if(1&o&&(t.TgZ(0,"form",5),t._UZ(1,"app-dropdown",6),t.ALo(2,"translate"),t.ALo(3,"translate"),t.TgZ(4,"div",7),t._UZ(5,"app-dropdown",8),t.ALo(6,"translate"),t.ALo(7,"translate"),t.qZA(),t._UZ(8,"app-dropdown",9),t.ALo(9,"translate"),t.ALo(10,"translate"),t.qZA()),2&o){const e=t.oxw();t.Q6J("formGroup",e.chartFilterFormGroup),t.xp6(1),t.Q6J("formGroup",e.chartFilterFormGroup)("options",e.countries$)("label",t.lcZ(2,10,"FIELDS.SELECT")+t.lcZ(3,12,"FIELDS.COUNTRY")),t.xp6(4),t.Q6J("formGroup",e.chartFilterFormGroup)("options",e.camps$)("label",t.lcZ(6,14,"FIELDS.SELECT")+t.lcZ(7,16,"FIELDS.CAMP")),t.xp6(3),t.Q6J("formGroup",e.chartFilterFormGroup)("options",e.schools$)("label",t.lcZ(9,18,"FIELDS.SELECT")+t.lcZ(10,20,"FIELDS.SCHOOL"))}}function Q(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",10)(1,"app-line",11),t.NdJ("selectedPoint",function(a){return t.CHM(e),t.oxw().getSelectedPoint(a)}),t.ALo(2,"translate"),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("labels",e.labels)("series",e.series)("yaxisTitle",t.lcZ(2,3,"LESSONS"))}}const Y=[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",children:[{path:"",component:(()=>{class o{constructor(e,s,a,n){this.homeService=e,this.fb=s,this.router=a,this.activatedRoute=n,this.labels=this.homeService.months,this.series=[],this.destroy=new I.x}ngOnInit(){this.initForm(),this.getChartData(),this.router.events.pipe((0,P.h)(e=>e instanceof g.m2)).subscribe(()=>{Object.getOwnPropertyNames(this.activatedRoute.snapshot.queryParams).length||this.chartFilterFormGroup.reset()})}initForm(){this.chartFilterFormGroup=this.fb.group({country:[null],camp:[null],school:[null]}),this.chartFilterFormGroup.valueChanges.pipe((0,O.R)(this.destroy)).subscribe(e=>this.filterChartData(e))}getChartData(){this.homeService.chartData$.pipe((0,O.R)(this.destroy)).subscribe(e=>{this.chartData=e,this.getLookups(),this.chartFilterFormGroup.patchValue(this.activatedRoute.snapshot.queryParams)})}getLookups(){const e=[{id:0,text:"Show All"}];this.countries$=this.homeService.countries,this.camps$=this.homeService.camps,this.schools$=this.homeService.schools.pipe((0,f.U)(s=>[...e,...s]))}filterChartData(e){var s;let a=[];const n=Object.keys(e).filter(l=>e[l]).filter(l=>"Show All"!==e[l]),c=(null===(s=this.chartData)||void 0===s?void 0:s.filter(l=>n.every(h=>l[h]===e[h])))||[],p=[...new Set(null==c?void 0:c.map(l=>l.school))];null==p||p.forEach(l=>{const h=(null==c?void 0:c.filter(v=>v.school===l))||[];a.push({name:l,data:this.homeService.generateSeriesDataByMonths(h)})}),this.series=[],setTimeout(()=>this.series=a),this.totalNoOfLessons=a.map(l=>l.data.reduce((h,v)=>h+v)).reduce((l,h)=>l+h);let u={};n.map(l=>u[l]=e[l]),Object.getOwnPropertyNames(u).length&&this.router.navigate([""],{relativeTo:this.activatedRoute,queryParams:u})}getSelectedPoint(e){const s=this.activatedRoute.snapshot.queryParamMap.get("country")||"",a=this.activatedRoute.snapshot.queryParamMap.get("camp")||"",n=Object.assign(Object.assign({},e),{country:s,camp:a});this.homeService.addPoint(n),localStorage.setItem("selectedPoint",JSON.stringify(n)),window.open(`${location.href.split("?").shift()}/details`,"_self")}ngOnDestroy(){this.destroy.next(!0)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b),t.Y36(d.qu),t.Y36(g.F0),t.Y36(g.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-home"]],decls:13,vars:12,consts:[[1,"analysis-chart","page-wrapper"],[1,"m-0","regular","font-26","text-main"],[1,"m-0","regular","font-20","text-main-light","mt-2"],["class","filter-wrapper d-flex flex-column flex-lg-row mt-4",3,"formGroup",4,"ngIf"],["class","chart-wrapper mt-4",4,"ngIf"],[1,"filter-wrapper","d-flex","flex-column","flex-lg-row","mt-4",3,"formGroup"],["controlName","country","bindValue","text",3,"formGroup","options","label"],[1,"mx-lg-3"],["controlName","camp","bindValue","text",3,"formGroup","options","label"],["controlName","school","bindValue","text",3,"formGroup","options","label"],[1,"chart-wrapper","mt-4"],[3,"labels","series","yaxisTitle","selectedPoint"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"h6",2),t._uU(5),t.ALo(6,"translate"),t.TgZ(7,"b"),t._uU(8),t.qZA(),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.YNc(11,M,11,22,"form",3),t.YNc(12,Q,3,5,"div",4),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,6,"CHART")),t.xp6(3),t.hij(" ",t.lcZ(6,8,"LESSONS")," - "),t.xp6(3),t.Oqu(s.totalNoOfLessons),t.xp6(1),t.hij(" ",t.lcZ(10,10,"FIELDS.LESSON")," "),t.xp6(2),t.Q6J("ngIf",s.chartFilterFormGroup),t.xp6(1),t.Q6J("ngIf",s.series.length))},directives:[m.O5,d._Y,d.JL,d.sg,H,U],pipes:[S.X$],styles:[""]}),o})()},{path:"details",component:T}]}];let j=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[g.Bz.forChild(Y)],g.Bz]}),o})();var R=i(1901);let z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[m.ez,j,R.m]]}),o})()}}]);